<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Unit Convertor</title>
  </head>
  <body>
    <%- include('../shared/header.ejs'); -%>
    <h1 style="text-align: center">Unit Convertor</h1>
    <div
      style="
        max-width: 500px;
        margin: 20px auto;
        padding: 20px;
        border: 1px solid #ccc;
        border-radius: 8px;
      "
    >
      <form id="converterForm">
        <div style="margin-bottom: 15px">
          <label for="unitType">Unit Type:</label>
          <select
            id="unitType"
            name="unitType"
            required
            style="width: 100%; padding: 8px"
          >
            <option value="">Select Unit Type</option>
            <option value="weight">Weight</option>
            <option value="length">Length</option>
            <option value="volume">Volume</option>
            <option value="temperature">Temperature</option>
          </select>
        </div>

        <div style="margin-bottom: 15px">
          <label>From:</label>
          <div style="display: flex; gap: 10px">
            <input
              type="number"
              id="inputValue"
              placeholder="Enter value"
              step="any"
              style="flex: 1; padding: 8px"
            />
            <select id="fromUnit" name="fromUnit" required style="padding: 8px">
              <option value="">Select unit</option>
            </select>
          </div>
        </div>

        <div style="margin-bottom: 15px">
          <label>To:</label>
          <div style="display: flex; gap: 10px">
            <input
              type="text"
              id="outputValue"
              placeholder="Result"
              readonly
              style="flex: 1; padding: 8px; background: #f5f5f5"
            />
            <select id="toUnit" name="toUnit" required style="padding: 8px">
              <option value="">Select unit</option>
            </select>
          </div>
        </div>

        <button
          type="button"
          onclick="convertUnits()"
          style="
            width: 100%;
            padding: 10px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
          "
        >
          Convert
        </button>
      </form>
    </div>

    <script>
      const unitData = {
        weight: {
          units: ["kg", "g", "mg", "lb", "oz"],
          toKg: { kg: 1, g: 0.001, mg: 0.000001, lb: 0.453592, oz: 0.0283495 },
        },
        length: {
          units: ["m", "cm", "mm", "km", "ft", "inch"],
          toM: {
            m: 1,
            cm: 0.01,
            mm: 0.001,
            km: 1000,
            ft: 0.3048,
            inch: 0.0254,
          },
        },
        volume: {
          units: ["liter", "ml", "gallon", "cup", "pint"],
          toLiter: {
            liter: 1,
            ml: 0.001,
            gallon: 3.78541,
            cup: 0.236588,
            pint: 0.473176,
          },
        },
        temperature: {
          units: ["celsius", "fahrenheit", "kelvin"],
          toKelvin: null,
        },
      };

      document
        .getElementById("unitType")
        .addEventListener("change", function () {
          const type = this.value;
          const fromUnit = document.getElementById("fromUnit");
          const toUnit = document.getElementById("toUnit");
          const input = document.getElementById("inputValue");

          fromUnit.innerHTML = '<option value="">Select unit</option>';
          toUnit.innerHTML = '<option value="">Select unit</option>';
          input.value = 0;

          if (type && unitData[type]) {
            unitData[type].units.forEach((unit) => {
              fromUnit.innerHTML += `<option value="${unit}">${unit}</option>`;
              toUnit.innerHTML += `<option value="${unit}">${unit}</option>`;
            });
          }
        });

      function convertUnits() {
        const type = document.getElementById("unitType").value;
        const inputValue = parseFloat(
          document.getElementById("inputValue").value,
        ).toFixed(4);
        const fromUnit = document.getElementById("fromUnit").value;
        const toUnit = document.getElementById("toUnit").value;
        const outputField = document.getElementById("outputValue");

        if (!type || !fromUnit || !toUnit || isNaN(inputValue)) {
          alert("Please fill all fields with valid values");
          return;
        }

        let result;
        const data = unitData[type];

        if (type === "temperature") {
          result = convertTemperature(inputValue, fromUnit, toUnit);
        } else {
          const baseUnit =
            type === "weight" ? "kg" : type === "length" ? "m" : "liter";
          const conversionKey =
            type === "weight" ? "toKg" : type === "length" ? "toM" : "toLiter";
          const baseValue = inputValue * data[conversionKey][fromUnit];
          result = baseValue / data[conversionKey][toUnit];
        }

        outputField.value = result.toFixed(4);
      }

      function convertTemperature(value, from, to) {
        let kelvin;
        if (from === "celsius") kelvin = value + 273.15;
        else if (from === "fahrenheit")
          kelvin = ((value - 32) * 5) / 9 + 273.15;
        else kelvin = value;

        if (to === "celsius") return kelvin - 273.15;
        else if (to === "fahrenheit") return ((kelvin - 273.15) * 9) / 5 + 32;
        else return kelvin;
      }
    </script>
  </body>
</html>
